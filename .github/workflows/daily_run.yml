name: ExpertAlpha-K100 Daily Scraper

on:
  schedule:
    # í•œêµ­ ì‹œê°„ ë°¤ 11:30 (UTC 14:30)
    - cron: '30 14 * * *'
  workflow_dispatch: # ì§ì ‘ ì‹¤í–‰ ë²„íŠ¼ì„ ë§Œë“¤ê¸° ìœ„í•œ ì˜µì…˜

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 pandas yfinance pytz schedule

    - name: Run Main Script
      run: |
        # ë°¤ 11:30ì— ëŒì•„ê°ˆ ë•Œ ì£¼ê°€ ì—…ë°ì´íŠ¸ê¹Œì§€ í¬í•¨í•´ì„œ ì •ë°€ ìˆ˜ì§‘
        python main.py --update-prices

    - name: Commit and Push DB change
      env:
        # ì‹œí¬ë¦¿ì— ì €ì¥í•˜ì‹  ì´ë¦„ì„ ì—¬ê¸°ì„œ ë¶ˆëŸ¬ì˜µë‹ˆë‹¤
        TOKEN: ${{ secrets.MY_GH_TOKEN }}
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        # ë°ì´í„°ë² ì´ìŠ¤ íŒŒì¼ì˜ ë³€ê²½ì‚¬í•­ì„ ì¶”ì 
        git add expert_alpha_v3.db
        
        # ë³€ê²½ì‚¬í•­ì´ ìˆì„ ë•Œë§Œ ì»¤ë°‹ (ì—†ìœ¼ë©´ í†µê³¼)
        git commit -m "ğŸ“ˆ Daily DB Update: $(date +'%Y-%m-%d')" || echo "No changes to commit"
        
        # í† í°ì„ ì‚¬ìš©í•˜ì—¬ ë³¸ì¸ ì €ì¥ì†Œì— ê°•ì œ í‘¸ì‹œ
        git push https://x-access-token:${TOKEN}@github.com/ezzone72/ExpertAlpha-K100.git
